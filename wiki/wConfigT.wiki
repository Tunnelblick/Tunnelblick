#summary Setting up Tunnelblick
#sidebar wSb

<wiki:toc max_depth="2" />

<font color="red">Stop</font> if you have a [wCusDeployed "Deployed" version] of Tunnelblick. It comes already set up -- you do no need to do anything more. Just [wUsing  start using it] and enjoy!

<font color="red">Stop</font> if you have purchased VPN service from a VPN service provider. They should provide you with configuration files and instructions on how to use them with Tunnelblick.

<font color="red">Stop</font> if you have VPN service from a corporate or other network provided by your employer. Your network manager or IT department should provide you with configuration files and instructions on how to use them with Tunnelblick.

The rest of this document is for everyone else.

==Setting Up Configurations==
It is not enough to install Tunnelblick:  you also need to tell Tunnelblick *_how to connect_* to a VPN.

You tell Tunnelblick how to connect to a VPN with a configuration file. Tunnelblick can use two types of configuration files:
  * *Tunnelblick VPN Configurations.* A Tunnelblick VPN Configuration contains all of the information Tunnelblick needs to connect to a VPN. A Tunnelblick VPN Configuration contains an OpenVPN configuration file, and may contain key, certificate, and script files. Everything needed is contained within the Tunnelblick VPN Configuration.
  * *OpenVPN configuration files.* These are plain text files with extensions of .ovpn or .conf. These files usually contain only the configuration information; keys and certificates are held in separate files. *For more information about setting up Tunnelblick using OpenVPN configuration files, see [wConfigO Configuring OpenVPN].*

*We strongly suggest that you use a Tunnelblick VPN Configuration* because you can do more with it. For example, you can share it with all users of your computer, and you can set it up to start when your computer starts -- even before you log in. It is also more secure because any key and certificate files within it are made inaccessible except to the OpenVPN program, and because any script files within it are protected against accidental or deliberate misuse. Tunnelblick VPN Configurations may also contain other information, including information about default preferences for the configuration and identification and version information for the configuration itself that make managing widespread distribution easier. For details, see [wPkgs Tunnelblick VPN Connections].

==Creating a Tunnelblick VPN Configuration==
To create a Tunnelblick VPN Configuration:

 # Create a folder anywhere (on your Desktop works well);
 # Name the folder with the name you want the configuration known by in Tunnelblick;
 # Put all the files related to the connection into the folder (see [#Files_Contained_in_a_Tunnelblick_VPN_Configuration Files Contained in a Tunnelblick VPN Configuration], below);
 # Add an extension of ".tblk" at the end of the folder name. When you do this the folder will change into a Tunnelblick VPN Configuration.

To install  a Tunnelblick VPN Configuration, just double-click it. You will be asked if you want the configuration to be private or shared. A private configuration may only be used when you are logged onto the computer. A shared configuration may be used by anyone who is logged into the computer. If the name you have given conflicts with the name of an existing installed configuration, you will be given the opportunity to change the name.

That's it! You are done. The configuration will be available immediately in Tunnelblick.

==Files Contained in a Tunnelblick VPN Configuration==
The files that should be contained in a Tunnelblick VPN Configuration (the "files related to the connection" in 3. above):
 * One (and only one) OpenVPN configuration file (a .ovpn or .conf file).
 * Any certificate or key files for that configuration (.key, .crt, .pem, .cer, .der, .p12, .p7b, .p7c, and .pfx files); and
 * Any script files for the configuration. Script files must must have a .sh extension so that Tunnelblick can secure them and use them properly.

There is one more requirement: the OpenVPN configuration file (.ovpn or .conf file) must refer to the other files by their names and extensions only, without path information. In other words, the OpenVPN configuration file must have lines that look like

 key name.key<br>
 ca ca.crt<br>
 cert client26.crt<br>
 tls-auth ta.key 1<br>
 up up.sh<br>
 down down.sh

and not like

 key ~/Documents/name.key<br>
 ca VPN/ca.crt<br>
 cert /Test/123/456/client26.crt<br>

==The "Set Nameserver" Check Box and DNS & WINS Settings==
If you are using DHCP, wish to use DNS and WINS servers at the far end of the tunnel when connected, and the VPN server you are connecting to "pushes" DNS and WINS settings to your client, put a check in the "Set nameserver" checkbox. (This is the situation for most users.)

If you are using DHCP, wish to use your original DNS and WINS servers when connected, and the VPN server you are connecting to does not "push" DNS or WINS settings to your client, un-check the "Set nameserver" checkbox.

If you are using manual settings, different versions of OS X behave differently. This is due to a change in network behavior in Snow Leopard and is beyond the scope of this project to fix.

 * If you're using Leopard (10.5) or Tiger (10.4), then it is possible to use the VPN-server-supplied DNS and WINS settings *in addition to* your manual settings by checking the "Set nameserver" box. However, your manual settings will always take precedence over any VPN server-supplied settings.  If "Set nameserver" is un-checked, you will continue to use only your manually-configured settings and any VPN server-supplied settings will be ignored. "Take precedence" means that the manual DNS server will be used for all DNS queries unless it fails to answer, in which case the VPN server-supplied DNS server will be used.
 
 *If you are using Snow Leopard (10.6), then your usual DNS and WINS settings will *always* be used, and no aggregation of configurations will be performed.

 * If you set your DNS servers manually, then regardless of the state of the "Set nameserver" box, your manual DNS servers will always be the only ones used.

 * If you set your Search Domain(s) manually, then regardless of the state of the "Set nameserver" box, your manual Search Domains will always be the only ones used.

 * If you set your WINS servers manually, then regardless of the state of the "Set nameserver" box, your manual WINS servers will always be the only ones used.

 * Each of these settings is independent of the others: if "Set nameserver" is checked, those settings not configured manually will be replaced by the settings obtained from the VPN server.  If "Set nameserver" is not checked, then as with Leopard/Tiger, no DNS/WINS settings will be applied.

*If your situation is not described above* (e.g., if you use manual DNS settings and wish to use DNS servers at the far end of a tunnel when connected, or you wish to use the OS X ability to use different nameservers for different domains), you must create your own up/down scripts and un-check the "Set nameserver" checkbox.

==Using openvpn-down-root.so==
When using "Set nameserver" or your own down script for OpenVPN, it is usually necessary to avoid using the OpenVPN "user" and "group" options. These options cause OpenVPN to drop root privileges and take the privileges of the specified user and group. If this is done, then the down script that handles restarting connections when there is a transient problem fails, because it is run without root privileges. And restoring routes when a tunnel is disconnected fails, too.

However, Tunnelblick includes the "openvpn-down-root.so" plugin for OpenVPN. When this plugin is activated, OpenVPN still drops root privileges and runs as the specified user:group after a connection is made, but runs the down script run as root:wheel, so reconnecting after transient network problems works.

When you try to connect with a configuration that includes the "user" and/or "group" options in your configuration file. Tunnelblick will ask if you wish to use the openvpn-down-root plugin. Answer in the affirmative and Tunnelblick will use the plugin each time it makes a connection. Note that OpenVPN will still be unable to make route changes after the initial connection; they still have to be made in the scripts.

==When and How to NOT Use a Tunnelblick VPN Configuration==
Although Tunnelblick VPN Configurations are able to be shared and connected when your computer starts, they are only available on the latest versions of Tunnelblick (starting with Tunnelblick 3.1beta02). If you are using an older version of Tunnelblick or distributing a configuration to users of older versions of Tunnelblick, you must use only the OpenVPN configuration file (.ovpn or .conf extension). It must be located in

 ~/Library/Application Support/Tunnelblick/Configurations

which, for user "angelolaub", would be located at

 /Users/angelolaub/Library/Application Support/Tunnelblick/Configurations

You may put your certificate, key, and script files in that folder also.

Note that only the OpenVPN configuration file will be secured.

------------------

===PLEASE USE THE [http://groups.google.com/group/tunnelblick-discuss TUNNELBLICK DISCUSSION GROUP] FOR COMMENTS OR QUESTIONS===